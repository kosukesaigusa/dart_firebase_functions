// ignore_for_file: lines_longer_than_80_chars

import 'dart:typed_data';

import 'package:http/http.dart' as http;
import 'package:test/test.dart';

void main() {
  test('trigger google.cloud.firestore.document.v1.deleted event', () async {
    await http.post(
      Uri.parse('http://localhost:8080/'),
      body: _protobufBytesWhenDeletingDocument,
      headers: {
        'ce-dataschema':
            'https://github.com/googleapis/google-cloudevents/blob/main/proto/google/events/cloud/firestore/v1/data.proto',
        'accept-encoding': 'gzip, deflate, br',
        'authorization': 'Bearer <BEARER_TOKEN_HERE>',
        'ce-subject': 'documents/todos/6iGrCr5nJar6NNB8gPog',
        'ce-namespace': '(default)',
        'x-forwarded-proto': 'https',
        'forwarded': 'for="107.178.225.99";proto=https',
        'traceparent':
            '00-d2447ce13980f4633c00b01fe695fbb8-89b7c9af80c66f2e-01',
        'content-length': '485',
        'ce-source':
            '//firestore.googleapis.com/projects/full-dart-monorepo/databases/(default)',
        'ce-id': '32c909d5-1241-46b5-8212-b7ead57d2a1b',
        'ce-type': 'google.cloud.firestore.document.v1.deleted',
        'x-cloud-trace-context':
            'd2447ce13980f4633c00b01fe695fbb8/9923622059551125294;o=1',
        'user-agent':
            'APIs-Google; (+https://developers.google.com/webmasters/APIs-Google.html)',
        'ce-time': '2024-02-04T04:01:06.318191Z',
        'ce-database': '(default)',
        'content-type': 'application/protobuf',
        'from': 'noreply@google.com',
        'accept': 'application/json',
        'ce-location': 'asia-northeast1',
        'ce-specversion': '1.0',
        'host': 'ondeletetodo-cwi73pbowq-an.a.run.app',
        'x-forwarded-for': '107.178.225.99',
        'ce-document': 'todos/6iGrCr5nJar6NNB8gPog',
        'ce-project': 'full-dart-monorepo',
      },
    );
  });
}

// ignore: unreachable_from_main
final deleteDocumentEventData = {
  'oldValue': {
    'name':
        'projects/full-dart-monorepo/databases/(default)/documents/todos/6iGrCr5nJar6NNB8gPog',
    'fields': {
      'geopointField': {
        'geoPointValue': {'latitude': 1.23, 'longitude': 4.56},
      },
      'doubleField': {'doubleValue': 3.14},
      'arrayField': {
        'arrayValue': {
          'values': [
            {'stringValue': 'hello'},
            {'doubleValue': 3.14},
          ],
        },
      },
      'referenceField': {
        'referenceValue':
            'projects/full-dart-monorepo/databases/(default)/documents/todos/6iGrCr5nJar6NNB8gPog',
      },
      'integerField': {'integerValue': '1'},
      'mapField': {
        'mapValue': {
          'fields': {
            'message': {'stringValue': 'hello'},
          },
        },
      },
      'nullField': {'nullValue': 'NULL_VALUE'},
      'timestampField': {'timestampValue': '2024-02-03T03:34:56.720Z'},
      'stringField': {'stringValue': 'a'},
      'title': {'stringValue': 'null from server!'},
    },
    'createTime': '2024-02-03T10:58:22.147439Z',
    'updateTime': '2024-02-03T10:58:24.036383Z',
  },
};

/// A record in protobuf when deleting todo document.
final _protobufBytesWhenDeletingDocument =
    Uint8List.fromList(_bytesWhenDeletingDocument);

/// A record in json when deleting todo document.
final _bytesWhenDeletingDocument = [
  18,
  226,
  3,
  10,
  84,
  112,
  114,
  111,
  106,
  101,
  99,
  116,
  115,
  47,
  102,
  117,
  108,
  108,
  45,
  100,
  97,
  114,
  116,
  45,
  109,
  111,
  110,
  111,
  114,
  101,
  112,
  111,
  47,
  100,
  97,
  116,
  97,
  98,
  97,
  115,
  101,
  115,
  47,
  40,
  100,
  101,
  102,
  97,
  117,
  108,
  116,
  41,
  47,
  100,
  111,
  99,
  117,
  109,
  101,
  110,
  116,
  115,
  47,
  116,
  111,
  100,
  111,
  115,
  47,
  54,
  105,
  71,
  114,
  67,
  114,
  53,
  110,
  74,
  97,
  114,
  54,
  78,
  78,
  66,
  56,
  103,
  80,
  111,
  103,
  18,
  37,
  10,
  13,
  103,
  101,
  111,
  112,
  111,
  105,
  110,
  116,
  70,
  105,
  101,
  108,
  100,
  18,
  20,
  66,
  18,
  9,
  174,
  71,
  225,
  122,
  20,
  174,
  243,
  63,
  17,
  61,
  10,
  215,
  163,
  112,
  61,
  18,
  64,
  18,
  24,
  10,
  11,
  100,
  111,
  117,
  98,
  108,
  101,
  70,
  105,
  101,
  108,
  100,
  18,
  9,
  25,
  31,
  133,
  235,
  81,
  184,
  30,
  9,
  64,
  18,
  37,
  10,
  10,
  97,
  114,
  114,
  97,
  121,
  70,
  105,
  101,
  108,
  100,
  18,
  23,
  74,
  21,
  10,
  8,
  138,
  1,
  5,
  104,
  101,
  108,
  108,
  111,
  10,
  9,
  25,
  31,
  133,
  235,
  81,
  184,
  30,
  9,
  64,
  18,
  104,
  10,
  14,
  114,
  101,
  102,
  101,
  114,
  101,
  110,
  99,
  101,
  70,
  105,
  101,
  108,
  100,
  18,
  86,
  42,
  84,
  112,
  114,
  111,
  106,
  101,
  99,
  116,
  115,
  47,
  102,
  117,
  108,
  108,
  45,
  100,
  97,
  114,
  116,
  45,
  109,
  111,
  110,
  111,
  114,
  101,
  112,
  111,
  47,
  100,
  97,
  116,
  97,
  98,
  97,
  115,
  101,
  115,
  47,
  40,
  100,
  101,
  102,
  97,
  117,
  108,
  116,
  41,
  47,
  100,
  111,
  99,
  117,
  109,
  101,
  110,
  116,
  115,
  47,
  116,
  111,
  100,
  111,
  115,
  47,
  54,
  105,
  71,
  114,
  67,
  114,
  53,
  110,
  74,
  97,
  114,
  54,
  78,
  78,
  66,
  56,
  103,
  80,
  111,
  103,
  18,
  18,
  10,
  12,
  105,
  110,
  116,
  101,
  103,
  101,
  114,
  70,
  105,
  101,
  108,
  100,
  18,
  2,
  16,
  1,
  18,
  35,
  10,
  8,
  109,
  97,
  112,
  70,
  105,
  101,
  108,
  100,
  18,
  23,
  50,
  21,
  10,
  19,
  10,
  7,
  109,
  101,
  115,
  115,
  97,
  103,
  101,
  18,
  8,
  138,
  1,
  5,
  104,
  101,
  108,
  108,
  111,
  18,
  15,
  10,
  9,
  110,
  117,
  108,
  108,
  70,
  105,
  101,
  108,
  100,
  18,
  2,
  88,
  0,
  18,
  32,
  10,
  14,
  116,
  105,
  109,
  101,
  115,
  116,
  97,
  109,
  112,
  70,
  105,
  101,
  108,
  100,
  18,
  14,
  82,
  12,
  8,
  224,
  232,
  246,
  173,
  6,
  16,
  128,
  168,
  169,
  215,
  2,
  18,
  19,
  10,
  11,
  115,
  116,
  114,
  105,
  110,
  103,
  70,
  105,
  101,
  108,
  100,
  18,
  4,
  138,
  1,
  1,
  97,
  18,
  29,
  10,
  5,
  116,
  105,
  116,
  108,
  101,
  18,
  20,
  138,
  1,
  17,
  110,
  117,
  108,
  108,
  32,
  102,
  114,
  111,
  109,
  32,
  115,
  101,
  114,
  118,
  101,
  114,
  33,
  26,
  11,
  8,
  206,
  184,
  248,
  173,
  6,
  16,
  152,
  251,
  166,
  70,
  34,
  11,
  8,
  208,
  184,
  248,
  173,
  6,
  16,
  152,
  210,
  172,
  17,
];
